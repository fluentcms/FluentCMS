@inherits BasePlugin

@namespace FluentCMS.Web.UI.Plugins

<PluginForm Model="@Model" Name="@FORM_NAME" Title="Update Layout" OnSubmit="OnSubmit">
    <PluginFormTextInput @bind-Value="Model.Name" Cols="8" Label="Username" Placeholder="Enter layout name" Required />
    <PluginFormCheckbox @bind-Value="Model.IsDefault" Cols="4" Label="Default" />
    <PluginFormTextarea @bind-Value="Model.Head" Label="Layout Head" Placeholder="Enter layout head section" Required />
    <PluginFormTextarea @bind-Value="Model.Body" Label="Layout Body" Placeholder="Enter layout body section" Required />
    <PluginFormActions Cancel Submit />
</PluginForm>

@code {
    public const string FORM_NAME = "LayoutUpdateForm";

    [SupplyParameterFromForm(FormName = FORM_NAME)]
    private LayoutUpdateRequest Model { get; set; } = new();

    [SupplyParameterFromQuery(Name = "id")]
    private Guid Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var layoutResponse = await GetApiClient<LayoutClient>().GetAsync(Id);
        var layout = layoutResponse.Data;
        Model.IsDefault = layout.IsDefault;
        Model.Name = layout.Name;
        Model.Head = layout.Head;
        Model.Body = layout.Body;
    }

    private async Task OnSubmit()
    {
        await GetApiClient<LayoutClient>().UpdateAsync(Model);
        NavigateBack();
    }
}
